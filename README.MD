# Guide Nuxt 4 - DÃ©marrage rapide

## Architecture du projet

Nuxt 4 introduit une nouvelle structure avec le dossier **`app/`** qui centralise tout le code de l'application Vue :

```
mon-projet/
â”œâ”€â”€ app/                 # ğŸ†• Dossier principal de l'application
â”‚   â”œâ”€â”€ app.vue         # Point d'entrÃ©e principal (optionnel si tu as pages/)
â”‚   â”œâ”€â”€ pages/          # Routes front-end
â”‚   â”‚   â”œâ”€â”€ index.vue   # Route: /
â”‚   â”‚   â”œâ”€â”€ documents.vue    # Route: /documents
â”‚   â”‚   â””â”€â”€ documents/
â”‚   â”‚       â””â”€â”€ [id].vue     # Route: /documents/:id
â”‚   â”œâ”€â”€ layouts/        # Layouts pour structurer les pages
â”‚   â”‚   â”œâ”€â”€ default.vue # Layout par dÃ©faut
â”‚   â”‚   â””â”€â”€ custom.vue  # Layout personnalisÃ©
â”‚   â”œâ”€â”€ components/     # Composants Vue rÃ©utilisables
â”‚   â”œâ”€â”€ composables/    # Composables (logique rÃ©utilisable)
â”‚   â”œâ”€â”€ middleware/     # Middleware de navigation
â”‚   â”œâ”€â”€ plugins/        # Plugins Nuxt
â”‚   â””â”€â”€ utils/          # Fonctions utilitaires
â”œâ”€â”€ server/             # ğŸ”§ Code serveur (sÃ©parÃ© de l'app)
â”‚   â”œâ”€â”€ api/           # Routes API
â”‚   â”‚   â”œâ”€â”€ documents.get.ts      # GET /api/documents
â”‚   â”‚   â””â”€â”€ documents/
â”‚   â”‚       â””â”€â”€ [id].get.ts       # GET /api/documents/:id
â”‚   â”œâ”€â”€ routes/        # Routes serveur personnalisÃ©es
â”‚   â”œâ”€â”€ middleware/    # Middleware serveur
â”‚   â””â”€â”€ utils/         # Utilitaires serveur
â”œâ”€â”€ public/            # Fichiers statiques (images, fonts, etc.)
â”œâ”€â”€ .nuxt/             # âš ï¸ Fichiers gÃ©nÃ©rÃ©s (ne pas toucher)
â”œâ”€â”€ nuxt.config.ts     # Configuration Nuxt
â””â”€â”€ package.json
```

**Points clÃ©s de Nuxt 4 :**
- **`app/`** : Tout le code front-end (Vue) est dans ce dossier
- **`server/`** : Tout le code back-end (API) est sÃ©parÃ©
- **Meilleure sÃ©paration** : code client vs code serveur
- **Type-safety amÃ©liorÃ©e** : TypeScript fonctionne mieux avec cette structure
- Les fichiers dans `app/pages/` crÃ©ent automatiquement des routes
- Les fichiers dans `server/api/` crÃ©ent automatiquement des endpoints API

---

## Le fichier app.vue - Point d'entrÃ©e principal

Le fichier `app/app.vue` est le composant racine de ton application. C'est par lÃ  que tout passe !

### Cas 1 : Projet sans pages (landing page simple)

Si tu ne crÃ©es **pas** de dossier `app/pages/`, Nuxt affiche par dÃ©faut `<NuxtWelcome />` :

**Fichier :** `app/app.vue` (celui crÃ©Ã© par dÃ©faut)

```vue
<template>
  <div>
    <NuxtWelcome />
  </div>
</template>
```

ğŸ‘‰ `<NuxtWelcome />` est juste un Ã©cran de bienvenue. **Tu dois le supprimer ou remplacer** par ton contenu !

---

### Cas 2 : Projet avec routing (le plus courant)

DÃ¨s que tu crÃ©es le dossier `app/pages/`, tu **dois** utiliser `<NuxtPage />` dans `app.vue` :

**Fichier :** `app/app.vue`

```vue
<template>
  <div>
    <NuxtLayout>
      <NuxtPage />
    </NuxtLayout>
  </div>
</template>
```

**Explications :**
- `<NuxtPage />` : Affiche la page correspondant Ã  la route actuelle (contenu de `app/pages/`)
- `<NuxtLayout>` : Entoure la page avec un layout (header, footer, menu, etc.)

---

### Variante : Sans layouts

Si tu n'as **pas besoin** de layouts (pas de structure commune entre tes pages), tu peux simplifier :

```vue
<template>
  <div>
    <NuxtPage />
  </div>
</template>
```

Mais c'est rare ! En gÃ©nÃ©ral, on veut un header/footer commun, donc on garde `<NuxtLayout>`.

---

### Variante : Structure globale dans app.vue

Tu peux aussi mettre des Ã©lÃ©ments globaux directement dans `app.vue` :

```vue
<template>
  <div>
    <header>
      <h1>Mon site</h1>
      <nav>
        <NuxtLink to="/">Accueil</NuxtLink>
        <NuxtLink to="/documents">Documents</NuxtLink>
      </nav>
    </header>

    <main>
      <NuxtLayout>
        <NuxtPage />
      </NuxtLayout>
    </main>

    <footer>
      <p>Â© 2025 Mon site</p>
    </footer>
  </div>
</template>
```

âš ï¸ **Attention** : Tout ce que tu mets dans `app.vue` est **global** (CSS, JS) et inclus dans toutes les pages.

---

## Les Layouts - Structure commune des pages

Les layouts permettent d'avoir une structure commune (header, footer, sidebar) pour plusieurs pages.

### Layout par dÃ©faut

**Fichier :** `app/layouts/default.vue`

```vue
<template>
  <div class="layout">
    <header class="header">
      <nav>
        <NuxtLink to="/">Accueil</NuxtLink>
        <NuxtLink to="/documents">Documents</NuxtLink>
      </nav>
    </header>

    <main class="content">
      <!-- C'est ici que le contenu de la page s'affiche -->
      <slot />
    </main>

    <footer class="footer">
      <p>Â© 2025 Mon application</p>
    </footer>
  </div>
</template>

<style scoped>
.layout {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.header {
  background: #333;
  color: white;
  padding: 1rem;
}

.header nav {
  display: flex;
  gap: 1rem;
}

.header a {
  color: white;
  text-decoration: none;
}

.content {
  flex: 1;
  padding: 2rem;
}

.footer {
  background: #f5f5f5;
  padding: 1rem;
  text-align: center;
}
</style>
```

**Important :**
- Le `<slot />` est **obligatoire** : c'est lÃ  que le contenu de la page s'insÃ¨re
- Le layout doit avoir **un seul Ã©lÃ©ment racine** (ici `<div class="layout">`)

---

### Layout personnalisÃ© (exemple : admin)

**Fichier :** `app/layouts/admin.vue`

```vue
<template>
  <div class="admin-layout">
    <aside class="sidebar">
      <h2>Admin</h2>
      <nav>
        <NuxtLink to="/admin">Dashboard</NuxtLink>
        <NuxtLink to="/admin/users">Users</NuxtLink>
      </nav>
    </aside>

    <div class="main-content">
      <slot />
    </div>
  </div>
</template>

<style scoped>
.admin-layout {
  display: flex;
}

.sidebar {
  width: 250px;
  background: #2c3e50;
  color: white;
  padding: 1rem;
}

.main-content {
  flex: 1;
  padding: 2rem;
}
</style>
```

### Utiliser un layout spÃ©cifique dans une page

**Fichier :** `app/pages/admin/index.vue`

```vue
<script setup lang="ts">
// DÃ©finir le layout pour cette page
definePageMeta({
  layout: 'admin'
})
</script>

<template>
  <div>
    <h1>Admin Dashboard</h1>
    <p>Bienvenue dans l'espace admin</p>
  </div>
</template>
```

---

### Pas de layout pour une page

Si tu veux dÃ©sactiver le layout pour une page spÃ©cifique :

```vue
<script setup lang="ts">
definePageMeta({
  layout: false
})
</script>

<template>
  <div>
    <h1>Page sans layout</h1>
  </div>
</template>
```

---

## âœ… Checklist pour dÃ©marrer

1. **Supprimer ou remplacer** `<NuxtWelcome />` dans `app.vue`
2. CrÃ©er le dossier `app/pages/` pour activer le routing
3. Mettre `<NuxtLayout><NuxtPage /></NuxtLayout>` dans `app.vue`
4. CrÃ©er `app/layouts/default.vue` avec ton header/footer
5. CrÃ©er tes pages dans `app/pages/`

---

## Routes API serveur

### Route simple sans paramÃ¨tres : GET tous les documents

**Fichier :** `server/api/documents.get.ts`

```typescript
// GET /api/documents
export default defineEventHandler(async (event) => {
  // Simule une rÃ©cupÃ©ration de donnÃ©es
  // En vrai, tu ferais un appel DB ici
  const documents = [
    { id: 1, title: "Document 1", content: "Contenu du document 1" },
    { id: 2, title: "Document 2", content: "Contenu du document 2" },
    { id: 3, title: "Document 3", content: "Contenu du document 3" }
  ]
  
  return {
    success: true,
    data: documents
  }
})
```

**Points clÃ©s :**
- Le nom du fichier dÃ©termine la mÃ©thode HTTP : `.get.ts`, `.post.ts`, `.put.ts`, `.delete.ts`
- `defineEventHandler` est la fonction pour dÃ©finir un handler d'Ã©vÃ©nement
- Tu retournes directement l'objet JSON

---

### Route avec paramÃ¨tre : GET un document par ID

**Fichier :** `server/api/documents/[id].get.ts`

```typescript
// GET /api/documents/:id
export default defineEventHandler(async (event) => {
  // RÃ©cupÃ¨re le paramÃ¨tre 'id' de l'URL
  const id = getRouterParam(event, 'id')
  
  // Simule une recherche en DB
  const documents = [
    { id: 1, title: "Document 1", content: "Contenu du document 1" },
    { id: 2, title: "Document 2", content: "Contenu du document 2" },
    { id: 3, title: "Document 3", content: "Contenu du document 3" }
  ]
  
  const document = documents.find(d => d.id === parseInt(id || '0'))
  
  if (!document) {
    // Erreur 404 si le document n'existe pas
    throw createError({
      statusCode: 404,
      statusMessage: 'Document non trouvÃ©'
    })
  }
  
  return {
    success: true,
    data: document
  }
})
```

**Points clÃ©s :**
- Les crochets `[id]` dans le nom de fichier indiquent un paramÃ¨tre dynamique
- Utilise `getRouterParam(event, 'nomParam')` pour rÃ©cupÃ©rer le paramÃ¨tre
- Tu peux utiliser `createError()` pour renvoyer des erreurs HTTP

---

## Appeler les routes API depuis les pages Vue

### Page pour lister tous les documents

**Fichier :** `app/pages/documents.vue`

```vue
<script setup lang="ts">
// useFetch : composable Nuxt pour fetcher des donnÃ©es
// Avantages : 
// - SSR-friendly (pas de double appel client/serveur)
// - Gestion automatique du loading et des erreurs
// - DonnÃ©es rÃ©actives
const { data, pending, error, refresh } = await useFetch('/api/documents')
</script>

<template>
  <div class="documents-page">
    <h1>Liste des documents</h1>
    
    <!-- Affiche un loader pendant le chargement -->
    <div v-if="pending" class="loading">
      Chargement...
    </div>
    
    <!-- Affiche une erreur si Ã§a a plantÃ© -->
    <div v-else-if="error" class="error">
      Erreur : {{ error.message }}
    </div>
    
    <!-- Affiche les documents -->
    <div v-else-if="data?.success">
      <ul>
        <li v-for="doc in data.data" :key="doc.id">
          <NuxtLink :to="`/documents/${doc.id}`">
            {{ doc.title }}
          </NuxtLink>
        </li>
      </ul>
      
      <!-- Bouton pour rafraÃ®chir les donnÃ©es -->
      <button @click="refresh">RafraÃ®chir</button>
    </div>
  </div>
</template>

<style scoped>
.documents-page {
  padding: 2rem;
}

.loading {
  color: #666;
  font-style: italic;
}

.error {
  color: red;
  padding: 1rem;
  background: #fee;
  border-radius: 4px;
}

ul {
  list-style: none;
  padding: 0;
}

li {
  margin: 1rem 0;
  padding: 1rem;
  background: #f5f5f5;
  border-radius: 4px;
}
</style>
```

---

### Page pour afficher un document spÃ©cifique

**Fichier :** `app/pages/documents/[id].vue`

```vue
<script setup lang="ts">
// RÃ©cupÃ¨re les paramÃ¨tres de la route
const route = useRoute()

// Fetch dynamique : l'URL se met Ã  jour si l'id change
// La fonction flÃ©chÃ©e () => permet de rendre l'URL rÃ©active
const { data, pending, error } = await useFetch(() => `/api/documents/${route.params.id}`)
</script>

<template>
  <div class="document-page">
    <!-- Bouton retour -->
    <NuxtLink to="/documents" class="back-link">
      â† Retour Ã  la liste
    </NuxtLink>
    
    <div v-if="pending" class="loading">
      Chargement...
    </div>
    
    <div v-else-if="error" class="error">
      <h2>Erreur</h2>
      <p>{{ error.message }}</p>
    </div>
    
    <div v-else-if="data?.success" class="document">
      <h1>{{ data.data.title }}</h1>
      <div class="content">
        {{ data.data.content }}
      </div>
      <div class="meta">
        <small>ID : {{ data.data.id }}</small>
      </div>
    </div>
  </div>
</template>

<style scoped>
.document-page {
  padding: 2rem;
  max-width: 800px;
  margin: 0 auto;
}

.back-link {
  display: inline-block;
  margin-bottom: 2rem;
  color: #0066cc;
  text-decoration: none;
}

.back-link:hover {
  text-decoration: underline;
}

.loading {
  color: #666;
  font-style: italic;
}

.error {
  color: red;
  padding: 1rem;
  background: #fee;
  border-radius: 4px;
}

.document {
  background: #fff;
  padding: 2rem;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.content {
  margin: 2rem 0;
  line-height: 1.6;
}

.meta {
  margin-top: 2rem;
  padding-top: 1rem;
  border-top: 1px solid #eee;
  color: #666;
}
</style>
```

---

## useFetch vs $fetch - Quand utiliser quoi ?

### `useFetch` - Pour les composants Vue (recommandÃ©)

```vue
<script setup>
// âœ… BON : useFetch dans un composant
// - Pas de double fetch (serveur + client)
// - DonnÃ©es transfÃ©rÃ©es via le payload Nuxt
// - Gestion automatique du state (pending, error, refresh)
const { data, pending, error } = await useFetch('/api/documents')
</script>
```

**Utilise `useFetch` quand :**
- Tu es dans un composant Vue
- Tu veux afficher des donnÃ©es au chargement de la page
- Tu veux le SSR (Server-Side Rendering)

---

### `$fetch` - Pour les actions utilisateur

```vue
<script setup>
// âœ… BON : $fetch pour une action (clic, submit, etc.)
async function deleteDocument(id: number) {
  try {
    await $fetch(`/api/documents/${id}`, {
      method: 'DELETE'
    })
    // RafraÃ®chir la liste aprÃ¨s suppression
    await refresh()
  } catch (error) {
    console.error('Erreur suppression:', error)
  }
}
</script>

<template>
  <button @click="deleteDocument(doc.id)">Supprimer</button>
</template>
```

**Utilise `$fetch` quand :**
- C'est dÃ©clenchÃ© par une action utilisateur (clic, submit)
- Tu es dans un event handler
- Tu fais un POST, PUT, DELETE

---

## RÃ©sumÃ© rapide

| Besoin | Solution |
|--------|----------|
| CrÃ©er une page | Fichier dans `app/pages/` |
| CrÃ©er un layout | Fichier dans `app/layouts/` |
| CrÃ©er une API | Fichier dans `server/api/` |
| GET tous | `server/api/ressource.get.ts` |
| GET un | `server/api/ressource/[id].get.ts` |
| Appeler API au chargement | `useFetch('/api/...')` |
| Appeler API sur action | `$fetch('/api/...')` |
| Point d'entrÃ©e de l'app | `app/app.vue` |
| Composant rÃ©utilisable | `app/components/` |

---

## Commandes utiles

```bash
# Lancer le serveur de dev
npm run dev

# Builder pour la production
npm run build

# PrÃ©visualiser le build de prod
npm run preview

# GÃ©nÃ©rer un site statique
npm run generate
```

---

## Pour aller plus loin

- **Documentation Nuxt 4** : https://nuxt.com/docs/4.x
- **Routing** : https://nuxt.com/docs/4.x/directory-structure/app/pages
- **Server API** : https://nuxt.com/docs/4.x/directory-structure/server
- **Data Fetching** : https://nuxt.com/docs/4.x/getting-started/data-fetching
